-- By Alexander Kramarenko
-- Interiew Preparation Course
-- Lesson 4 HW
-- Task 2
CREATE VIEW `task2` AS
SELECT m.title AS 'Фильм 1', ms.time_start AS 'Время начала', nd.duration AS 'Длительность', 
m2.title AS 'Фильм 2', ms2.time_start AS 'Время начала 2', nd2.duration  AS 'Длительность 2',
time(ms2.time_start - ms.time_start - nd.duration) AS 'Длительность перерыва'
FROM tbl_schedule ms 
LEFT JOIN tbl_movie_info m ON ms.movie_id = m.id
LEFT JOIN tbl_normalized_duration nd ON nd.id = m.normalized_duration_id,
            tbl_schedule ms2
LEFT JOIN tbl_movie_info m2 ON ms2.movie_id = m2.id
LEFT JOIN tbl_normalized_duration nd2 ON nd2.id = m2.normalized_duration_id
WHERE ms.id != ms2.id
AND time(ms2.time_start - ms.time_start - nd.duration) > '00:30:00'
ORDER BY time(ms2.time_start - ms.time_start - nd.duration) DESC;